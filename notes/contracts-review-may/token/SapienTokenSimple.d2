# SapienToken Contract - Simplified Flow Diagram

title: "SapienToken Contract - Flow Diagram" {
  near: top-center
  shape: text
  style.font-size: 24
  style.underline: true
}

# Main Actors and Components
User: {
  shape: person
  label: "User"
}

Safe: {
  shape: cylinder
  label: "Gnosis Safe\n(Admin)"
}

RewardsContract: {
  shape: rectangle
  label: "Rewards Contract"
  style.stroke-width: 2
}

SapienContract: {
  shape: rectangle
  label: "SapienToken Contract"
  style.stroke-width: 2
}

# Token Allocations
allocations: {
  style.opacity: 0.9
  style.fill: "#e6f7ff"
  style.stroke: "#69c0ff"
  label: "Token Allocations"
  
  investors: "Investors\n304.5M tokens\n48 months + 1 year cliff"
  team: "Team & Advisors\n165.5M tokens\n48 months + 1 year cliff"
  trainers: "Trainer Compensation\n175M tokens\n48 months"
  airdrops: "Airdrops\n130M tokens\n48 months"
  treasury: "Foundation Treasury\n130M tokens\n48 months"
  liquidity: "Liquidity Incentives\n95M tokens\n48 months"
}

# Vesting Process
vesting: {
  style.opacity: 0.9
  style.fill: "#f6ffed"
  style.stroke: "#b7eb8f"
  label: "Vesting Process"
  
  Safe -> SapienContract: "1. releaseTokens(allocationType)"
  SapienContract -> SapienContract: "2. Calculate vested amount"
  SapienContract -> Safe: "3. Transfer available tokens"
  SapienContract -> AllocationSafe: "4. Transfer to allocation safe"
}

# Administration
administration: {
  style.opacity: 0.9
  style.fill: "#f9f0ff"
  style.stroke: "#d3adf7"
  label: "Administration"
  
  Safe -> SapienContract: "Manage contract\n(pause/unpause/upgrade)"
}

# Rewards Process
rewards: {
  style.opacity: 0.9
  style.fill: "#fff2e8"
  style.stroke: "#ffbb96"
  label: "Rewards Process"
  
  # Changing Rewards Contract (Two-Step Process)
  Safe -> SapienContract: "1. proposeRewardsContract()"
  Safe -> SapienContract: "2. acceptRewardsContract()"
  
  # Using Rewards Contract
  RewardsContract -> SapienContract: "3. releaseTokens(allocationType)"
  SapienContract -> AllocationSafe: "4. Transfer tokens to recipient"
}

# Contract Features
features: {
  label: "Contract Features"
  shape: rectangle
  style.stroke-dash: 5
  style.opacity: 0.9
  
  upgradeability: "- UUPS Upgradeable\n- Two-step ownership\n- Two-tier upgrade control"
  security: "- Reentrancy protection\n- Pausable functionality\n- Two-step rewards contract changes"
  vesting: "- Configurable vesting schedules\n- Multiple allocation types\n- Safe address designation"
}

# Allocation Safe
AllocationSafe: {
  shape: cylinder
  label: "Allocation Safe\n(Recipients)"
}

# Connect the components for visual clarity
SapienContract -> allocations: "Manages"
Safe -> AllocationSafe: "Can update" 