# SapienStaking Contract - Simplified Flow Diagram

title: "SapienStaking Contract - Flow Diagram" {
  near: top-center
  shape: text
  style.font-size: 24
  style.underline: true
}

# Main Actors and Components
User: {
  shape: person
  label: "User"
}

Signer: {
  shape: person
  label: "Sapien Signer"
}

Safe: {
  shape: cylinder
  label: "Gnosis Safe\n(Admin)"
}

SapienContract: {
  shape: rectangle
  label: "SapienStaking Contract"
  style.stroke-width: 2
}

SapienToken: {
  shape: cylinder
  label: "Sapien Token\n(ERC20)"
}

# Staking Process
staking: {
  style.opacity: 0.9
  style.fill: "#e6f7ff"
  style.stroke: "#69c0ff"
  label: "Staking Process"
  
  User -> Signer: "1. Request signature"
  Signer -> User: "2. Sign approval"
  User -> SapienContract: "3. stake()"
  SapienContract -> SapienToken: "4. Transfer tokens"
  SapienContract -> User: "5. Emit Staked event"
}

# Unstaking Process (Regular)
unstaking: {
  style.opacity: 0.9
  style.fill: "#f6ffed"
  style.stroke: "#b7eb8f"
  label: "Regular Unstaking"
  
  # Initiate
  User -> Signer: "1. Request signature"
  Signer -> User: "2. Sign approval"
  User -> SapienContract: "3. initiateUnstake()"
  SapienContract -> User: "4. Start 2-day cooldown"
  
  # Complete after cooldown
  User -> Signer: "5. Request signature"
  Signer -> User: "6. Sign approval"
  User -> SapienContract: "7. unstake()"
  SapienContract -> SapienToken: "8. Transfer tokens"
  SapienContract -> User: "9. Emit Unstaked event"
}

# Instant Unstaking Process
instantUnstaking: {
  style.opacity: 0.9
  style.fill: "#fff2e8"
  style.stroke: "#ffbb96"
  label: "Instant Unstaking"
  
  User -> Signer: "1. Request signature"
  Signer -> User: "2. Sign approval"
  User -> SapienContract: "3. instantUnstake()"
  SapienContract -> SapienToken: "4. Transfer tokens (minus 20%)"
  SapienContract -> Safe: "5. Transfer 20% penalty"
  SapienContract -> User: "6. Emit InstantUnstake event"
}

# Administration
administration: {
  style.opacity: 0.9
  style.fill: "#f9f0ff"
  style.stroke: "#d3adf7"
  label: "Administration"
  
  Safe -> SapienContract: "Manage contract\n(pause/unpause/upgrade)"
}

# Contract Features
features: {
  label: "Contract Features"
  shape: rectangle
  style.stroke-dash: 5
  style.opacity: 0.9
  
  security: "- EIP-712 signatures\n- Order ID uniqueness\n- Reentrancy protection"
  multipliers: "- 30 days: 1.05x\n- 90 days: 1.10x\n- 180 days: 1.25x\n- 365 days: 1.50x"
  cooldown: "- 2-day cooldown period\n- 20% early withdrawal penalty"
  architecture: "- UUPS upgradeable\n- Pausable\n- Ownable2Step"
} 